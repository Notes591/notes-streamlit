import streamlit as st
import gspread
from oauth2client.service_account import ServiceAccountCredentials
import pandas as pd

# ====== Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª ======
scope = ["https://www.googleapis.com/auth/spreadsheets",
         "https://www.googleapis.com/auth/drive"]

# ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ù† Secrets
creds_dict = st.secrets["gcp_service_account"]
creds = ServiceAccountCredentials.from_json_keyfile_dict(creds_dict, scope)
client = gspread.authorize(creds)

# Ø§ÙØªØ­ Ø§Ù„Ø´ÙŠØª
SHEET_NAME = "Notes"
sheet = client.open(SHEET_NAME).sheet1

st.set_page_config(page_title="Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ù†Ø³Ø®Ø© ÙˆÙŠØ¨)", page_icon="ğŸ“", layout="centered")

st.title("ğŸŸ¨ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ù†Ø³Ø®Ø© ÙˆÙŠØ¨)")

# ====== Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ======
refresh_interval = 15  # Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
st.caption(f"â³ ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ {refresh_interval} Ø«Ø§Ù†ÙŠØ©")

st_autorefresh = st.autorefresh(
    interval=refresh_interval * 1000,  # Ø¨Ø§Ù„Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©
    key="datarefresh"
)

# ====== Ø¥Ø¯Ø®Ø§Ù„ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø© ======
with st.form("note_form"):
    note_text = st.text_area("âœï¸ Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©:")
    submitted = st.form_submit_button("â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©")

    if submitted and note_text.strip():
        sheet.append_row([note_text])
        st.success("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©!")

# ====== Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ======
st.subheader("ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª")
notes = sheet.get_all_records()

if notes:
    df = pd.DataFrame(notes)
    st.table(df)
else:
    st.info("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ø¹Ø¯. Ø£Ø¶Ù ÙˆØ§Ø­Ø¯Ø© Ù…Ù† ÙÙˆÙ‚ â¬†ï¸")
